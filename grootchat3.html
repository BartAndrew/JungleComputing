<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GrootGPT – Multi‑Chat</title>
  <style>
    /*
      GrootGPT v3

      This version improves upon the previous release by properly
      displaying the background images (Groot1 and Groot2) with a dark
      overlay and providing a narrower chat column reminiscent of the
      official ChatGPT layout. The backgrounds are preloaded as hidden
      images and applied via their computed src attributes so the
      environment can convert local paths to URLs automatically. A
      semi‑transparent overlay on the main area ensures text remains
      readable against the images.
    */

    :root {
      --sidebar-width: 260px;
      --sidebar-bg: #202123;
      --sidebar-border: #2d2d2d;
      --main-bg: #343541;
      --text-light: #ececf1;
      --text-muted: #8e8ea0;
      --accent: #10a37f;
      --message-user-bg: #0d6efd;
      --message-groot-bg: #444654;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
        sans-serif;
      color: var(--text-light);
      background-color: var(--main-bg);
      overflow: hidden;
      background-position: center;
      background-size: cover;
      background-attachment: fixed;
    }

    /* Sidebar styling */
    #sidebar {
      width: var(--sidebar-width);
      background-color: var(--sidebar-bg);
      border-right: 1px solid var(--sidebar-border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--sidebar-border);
      font-weight: 600;
      font-size: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #new-chat-btn {
      display: block;
      width: 100%;
      padding: 8px 12px;
      margin: 12px 0;
      border: 1px solid var(--sidebar-border);
      border-radius: 6px;
      background-color: transparent;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #new-chat-btn:hover {
      background-color: #2a2b33;
    }
    #chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 0 8px;
    }
    .chat-item {
      padding: 8px 12px;
      margin-bottom: 4px;
      border-radius: 6px;
      cursor: pointer;
      word-break: break-word;
    }
    .chat-item:hover {
      background-color: #2a2b33;
    }
    .chat-item.active {
      background-color: #40414f;
    }
    #sidebar-footer {
      padding: 12px;
      border-top: 1px solid var(--sidebar-border);
      font-size: 0.9rem;
    }
    #settings-toggle {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #settings-panel {
      display: none;
      padding-top: 8px;
    }
    #settings-panel label {
      display: block;
      margin: 8px 0 4px;
      font-weight: 600;
      font-size: 0.85rem;
    }
    #settings-panel select {
      width: 100%;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid var(--sidebar-border);
      background-color: #2a2b33;
      color: var(--text-light);
    }

    /* Main chat area */
    #main {
      position: relative;
      flex: 1;
      height: 100vh;
      overflow: hidden;
    }
    /* Dark overlay for readability when background image is applied */
    #main::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.3);
      pointer-events: none;
      z-index: 0;
    }
    /* Centered chat column */
    #chat-column {
      position: relative;
      max-width: 750px;
      margin: 0 auto;
      height: 100%;
      display: flex;
      flex-direction: column;
      z-index: 1; /* above overlay */
    }
    #chat-header {
      padding: 16px;
      border-bottom: 1px solid #3c3d43;
      font-weight: 600;
      font-size: 1rem;
      background-color: rgba(32, 33, 35, 0.6);
    }
    #chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
    }
    .message {
      display: flex;
      margin-bottom: 16px;
    }
    .message .text {
      padding: 12px 16px;
      border-radius: 8px;
      max-width: 80%;
      word-wrap: break-word;
      white-space: pre-wrap;
      line-height: 1.4;
      font-size: 0.95rem;
    }
    .message.user {
      justify-content: flex-end;
    }
    .message.user .text {
      background-color: var(--message-user-bg);
      color: #ffffff;
    }
    .message.groot {
      justify-content: flex-start;
    }
    .message.groot .text {
      background-color: var(--message-groot-bg);
      color: var(--text-light);
    }
    .typing {
      font-style: italic;
      opacity: 0.75;
    }
    /* Input box */
    #input-container {
      display: flex;
      padding: 16px;
      border-top: 1px solid #3c3d43;
      background-color: rgba(32, 33, 35, 0.6);
    }
    #user-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #555666;
      background-color: rgba(32, 33, 35, 0.8);
      color: var(--text-light);
      resize: none;
      font-size: 16px;
      line-height: 1.4;
    }
    #user-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    #send-button {
      margin-left: 12px;
      padding: 0 20px;
      border: none;
      border-radius: 6px;
      background-color: var(--accent);
      color: #ffffff;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #send-button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    #send-button:not(:disabled):hover {
      background-color: #0e9b70;
    }
  </style>
</head>
<body>
  <!-- Preload background images so the environment converts their paths to URLs -->
  <div style="display:none">
    <img id="bg-groot1" src="/home/oai/share/groot1.jpg" alt="Groot background 1" />
    <img id="bg-groot2" src="/home/oai/share/Groot2.jpg" alt="Groot background 2" />
  </div>
  <div id="sidebar">
    <div id="sidebar-header">
      <span>GrootGPT</span>
    </div>
    <button id="new-chat-btn">+ New chat</button>
    <div id="chat-list"></div>
    <div id="sidebar-footer">
      <div id="settings-toggle">⚙️ Settings</div>
      <div id="settings-panel">
        <label for="background-select">Chat background</label>
        <select id="background-select"></select>
      </div>
    </div>
  </div>
  <div id="main">
    <div id="chat-column">
      <div id="chat-header">New Chat</div>
      <div id="chat-messages"></div>
      <div id="input-container">
        <textarea id="user-input" rows="1" placeholder="Send a message..." aria-label="Message input"></textarea>
        <button id="send-button">Send</button>
      </div>
    </div>
  </div>
  <script>
    // Chat data stored in localStorage
    const STORAGE_KEY = 'grootGPT_chats';
    const SELECTED_CHAT_KEY = 'grootGPT_selectedChat';
    const BACKGROUND_KEY = 'grootGPT_background';

    // Background options: map keys to labels and image element IDs
    const backgroundOptions = {
      default: { label: 'Default dark', imgId: null },
      groot1: { label: 'Groot background 1', imgId: 'bg-groot1' },
      groot2: { label: 'Groot background 2', imgId: 'bg-groot2' }
    };

    // Load chats from localStorage or initialize an empty object
    let chats = {};
    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      chats = stored ? JSON.parse(stored) : {};
    } catch (e) {
      chats = {};
    }
    // Selected chat id
    let selectedChatId = localStorage.getItem(SELECTED_CHAT_KEY) || null;
    // Selected background key
    let backgroundChoice = localStorage.getItem(BACKGROUND_KEY) || 'default';

    // DOM elements
    const chatListEl = document.getElementById('chat-list');
    const chatHeaderEl = document.getElementById('chat-header');
    const chatMessagesEl = document.getElementById('chat-messages');
    const userInputEl = document.getElementById('user-input');
    const sendButtonEl = document.getElementById('send-button');
    const newChatBtn = document.getElementById('new-chat-btn');
    const settingsToggle = document.getElementById('settings-toggle');
    const settingsPanel = document.getElementById('settings-panel');
    const backgroundSelect = document.getElementById('background-select');

    // Responses variations
    const grootResponses = [
      'I am Groot.',
      'I am Groot!',
      'I am Groot?',
      'I am... Groot.',
      'I am Groot',
      "I'm Groot.",
      'I am GROOT!',
      'I am grooooot.',
      'I... am Groot'
    ];

    function getRandomGroot() {
      return grootResponses[Math.floor(Math.random() * grootResponses.length)];
    }
    function saveChats() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(chats));
      } catch (e) {
        console.error('Failed to save chats', e);
      }
    }
    function saveSelectedChat() {
      localStorage.setItem(SELECTED_CHAT_KEY, selectedChatId);
    }
    function saveBackgroundChoice() {
      localStorage.setItem(BACKGROUND_KEY, backgroundChoice);
    }
    function generateChatId() {
      return 'chat-' + Date.now();
    }
    function createNewChat() {
      const id = generateChatId();
      chats[id] = { messages: [] };
      selectedChatId = id;
      saveChats();
      saveSelectedChat();
      updateUI();
      userInputEl.focus();
    }
    function getChatTitle(chat) {
      if (chat.messages && chat.messages.length > 0) {
        const firstMsg = chat.messages.find(m => m.sender === 'user') || chat.messages[0];
        const text = firstMsg.text.trim();
        return text.length > 0 ? text.slice(0, 30) + (text.length > 30 ? '…' : '') : 'New Chat';
      }
      return 'New Chat';
    }
    function renderChatList() {
      chatListEl.innerHTML = '';
      const chatIds = Object.keys(chats);
      if (chatIds.length === 0) {
        createNewChat();
        return;
      }
      if (!selectedChatId || !chats[selectedChatId]) {
        selectedChatId = chatIds[0];
        saveSelectedChat();
      }
      chatIds.forEach(id => {
        const item = document.createElement('div');
        item.className = 'chat-item' + (id === selectedChatId ? ' active' : '');
        item.textContent = getChatTitle(chats[id]);
        item.addEventListener('click', () => {
          if (selectedChatId !== id) {
            selectedChatId = id;
            saveSelectedChat();
            updateUI();
          }
        });
        chatListEl.appendChild(item);
      });
    }
    function renderMessages() {
      chatMessagesEl.innerHTML = '';
      const chat = chats[selectedChatId];
      if (!chat) return;
      chat.messages.forEach(msg => {
        appendMessageElement(msg.text, msg.sender);
      });
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
      chatHeaderEl.textContent = getChatTitle(chat);
    }
    function appendMessageElement(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message ' + sender;
      const textDiv = document.createElement('div');
      textDiv.className = 'text' + (sender === 'typing' ? ' typing' : '');
      textDiv.textContent = text;
      messageDiv.appendChild(textDiv);
      chatMessagesEl.appendChild(messageDiv);
    }
    function handleSend() {
      const text = userInputEl.value.trim();
      if (!text) return;
      if (!selectedChatId || !chats[selectedChatId]) {
        createNewChat();
      }
      chats[selectedChatId].messages.push({ sender: 'user', text });
      appendMessageElement(text, 'user');
      userInputEl.value = '';
      resizeTextarea();
      saveChats();
      appendMessageElement('Groot is thinking...', 'groot');
      userInputEl.disabled = true;
      sendButtonEl.disabled = true;
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
      const delay = 800 + Math.random() * 1200;
      setTimeout(() => {
        const lastChild = chatMessagesEl.lastChild;
        if (lastChild && lastChild.querySelector('.typing')) {
          chatMessagesEl.removeChild(lastChild);
        }
        const reply = getRandomGroot();
        chats[selectedChatId].messages.push({ sender: 'groot', text: reply });
        appendMessageElement(reply, 'groot');
        saveChats();
        userInputEl.disabled = false;
        sendButtonEl.disabled = false;
        userInputEl.focus();
        chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
        renderChatList();
      }, delay);
    }
    function resizeTextarea() {
      userInputEl.style.height = 'auto';
      userInputEl.style.height = userInputEl.scrollHeight + 'px';
    }
    function renderBackgroundOptions() {
      backgroundSelect.innerHTML = '';
      Object.keys(backgroundOptions).forEach(key => {
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = backgroundOptions[key].label;
        if (key === backgroundChoice) opt.selected = true;
        backgroundSelect.appendChild(opt);
      });
    }
    function applyBackground() {
      // If default, remove image
      if (backgroundChoice === 'default') {
        document.body.style.backgroundImage = '';
      } else {
        const bg = backgroundOptions[backgroundChoice];
        const imgEl = bg.imgId ? document.getElementById(bg.imgId) : null;
        if (imgEl) {
          // Use the resolved src so the environment converts the path to a URL
          document.body.style.backgroundImage = `url('${imgEl.src}')`;
        }
      }
    }
    function initSettings() {
      settingsToggle.addEventListener('click', () => {
        const isVisible = settingsPanel.style.display === 'block';
        settingsPanel.style.display = isVisible ? 'none' : 'block';
      });
      renderBackgroundOptions();
      backgroundSelect.addEventListener('change', () => {
        backgroundChoice = backgroundSelect.value;
        saveBackgroundChoice();
        applyBackground();
      });
      applyBackground();
    }
    function updateUI() {
      renderChatList();
      renderMessages();
    }
    function initEventListeners() {
      newChatBtn.addEventListener('click', () => {
        createNewChat();
      });
      sendButtonEl.addEventListener('click', handleSend);
      userInputEl.addEventListener('keypress', event => {
        if (event.key === 'Enter' && !event.shiftKey) {
          event.preventDefault();
          handleSend();
        }
      });
      userInputEl.addEventListener('input', resizeTextarea);
    }
    (function init() {
      initEventListeners();
      initSettings();
      updateUI();
      resizeTextarea();
    })();
  </script>
</body>
</html>